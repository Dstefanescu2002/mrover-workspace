<root main_tree_to_execute = "MainTree" >
    <BehaviorTree ID="MainTree">
        <Fallback name="AutonStateSelector">
            <AutonOff>
            <!--Auton On Tree-->
            <Sequence>
                <!--Drive Tree-->
                <Selector>
                    <AtCurrentWaypoint name="atCurrentWaypoint">
                    <DriveToPoint name="driveToPoint">
                </Selector>
                <!--Waypoint Decision Tree (Manages the waypoint course)-->
                <Selector>
                    <!-- Search Point -->
                    <Sequence>
                        <SearchPoint name="isSearchPoint">
                        <!--Search Point Tree-->
                        <Selector>
                            <!--Know where the gate is?-->
                            <Sequence>
                                <IsFirstGatePostLocKnown name="isFirstGatePostLocKnown">
                                <Inverter>
                                    <Sequence>
                                        <Target2 name="hasTarget2">
                                        <PopulateSecondTarget name="populateSecondTarget">
                                        <GenerateGateTraversalPath name="genGateTraversalPath">
                                    </Sequence>
                                </Inverter>
                                <Sequence>
                                    <AtCurrentWaypoint name="atCurrentWaypoint">
                                    <!-- gimbal sub-tree for target 2-->
                                    <Selector>
                                        <SpinGimbal name="spinGimbal">
                                        <Sequence>
                                            <Target2 name="hasTarget2">
                                            <ResetGimbalIndex name="resetGimbalIndex">
                                            <PopulateSecondTarget name="populateSecondTarget">
                                            <GenerateGateTraversalPath name="genGateTraversalPath">
                                        </Sequence>
                                    </Selector>
                                    <PopCourse name="popCourse">
                                </Sequence>
                            </Sequence>

                            <!--Sees a target (for first time)-->
                            <Sequence>
                                <Target1 name="hasTarget1">
                                <PopulateFirstTarget name="populateFirstTarget">
                                <PutTargetAtFrontofCourse name="putTargetAtFrontOfCourse">
                            </Sequence>

                            <!--Reached Search Point,  refresh course-->
                            <Sequence>
                                <AtCurrentWaypoint name="atCurrentWaypoint">
                                <!--Repeator Drop Goes here if repeator needs to be added-->
                                <!-- gimbal sub-tree for target 1 -->
                                <Selector>
                                    <SpinGimbal name="spinGimbal">
                                        <Sequence>
                                            <Target2 name="hasTarget1">
                                            <ResetGimbalIndex name="resetGimbalIndex">
                                            <PopulateFirstTarget name="populateFirstTarget">
                                            <PutTargetAtFrontofCourse name="putTargetAtFrontOfCourse">
                                        </Sequence>
                                </Selector>
                                <PopCourse name="popCourse">

                            </Sequence>

                            <!--Repeator Drop Point Detection Goes here-->
                        </Selector>
                    </Sequence>
                    <!--Destination Point-->
                    <Sequence>
                        <DestinationPoint name="isDestinationPoint">
                        <Sequence>
                            <AtCurrentWaypoint name="atCurrentWaypoint">
                            <GenSearchPoints name="generateSearchPoints">
                        </Sequence>
                    </Sequence>
                    <!--Gate Traversal Point-->
                    <Sequence>
                        <GateTraversalPoint name="isGateTraversalPoint">
                        <!-- GATE TRAVERSAL TREE -->
                        <Sequence>
                            <AtCurrentWaypoint name="atCurrentWaypoint">
                            <Selector>
                                <Sequence>
                                    <Inverter>
                                        <hasGateTraversalPoints name="hasGateTraversalPoints"><!--"no more gate traversal points"-->
                                    </Inverter>
                                    <Sequence> <!-- TODO gimbal here -->
                                        <Selector>
                                            <SpinGimbal name="spinGimbal">
                                            <ForceFailure>
                                                <TurnOff name="turnOff">
                                            </ForceFailure>
                                        </Selector>
                                        <Sequence>
                                            <Target1 name="hasTarget1">
                                            <Target2 name="hasTarget2">
                                            <Selector>
                                                <VerifyTraversal name="verifyGateTraversal">
                                                <ForceFailure>
                                                    <TurnOff name="turnOff">
                                                </ForceFailure>
                                            </Selector>
                                        </Sequence>
                                    </Sequence>
                                    <Selector>
                                        <GenerateGateTraversalPath name="genGateTraversalPath">
                                        <TurnOff name="turnOff">
                                    </Selector>
                                </Sequence>
                                <Sequence>
                                    <hasGateTraversalPoints name="hasGateTraversalPoints">
                                    <PopCourse name="popCourse">
                                </Sequence>
                            </Selector>
                        </Sequence>
                    </Sequence>
                    <!--Target Approach Point-->
                    <Sequence>
                        <TargetApproachPoint name="isTargetApproachPoint">
                        <!--Target Approach Tree-->
                        <Sequence>
                            <AtCurrentWaypoint name="atCurrentWaypoint">
                            <Selector>
                                <Sequence>
                                    <ARTagLeg name="isARTagLeg">
                                    <ClearCourse name="clearCourse">
                                </Sequence>
                                <GenSecondPostSearchPattern name="genSecondPostSearchPattern">
                            </Selector>
                        </Sequence>
                    </Sequence>
                </Selector>
            </Sequence>
        </Fallback>
    </BehaviorTree>
</root>