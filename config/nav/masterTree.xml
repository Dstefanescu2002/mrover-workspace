<root main_tree_to_execute = "MainTree" >
    <BehaviorTree ID="MainTree">
        <Fallback>
            <IsOff/>
            <EmptyCourse/>
            <!--Auton On Tree-->
            <Sequence>
                <!--Drive Tree-->
                <Fallback>
                    <AtCurrentWaypoint/>
                    <DriveToPoint/>
                </Fallback>
                <!--Waypoint Decision Tree (Manages the waypoint course)-->
                <!--Commenting out the entire right side of the tree-->
                <Fallback>
                    <!-- Search Point -->
                    <Sequence>
                        <IsSearchPoint/>
                        <!--Search Point Tree-->
                        <Fallback>
                            <!--Know where the gate is?-->
                            <Sequence>
                                <IsFirstGatePostLocKnown/>
                                <Inverter>
                                    <Sequence>
                                        <HasTarget2/>
                                        <PopulateSecondTarget/>
                                        <GenGateTraversalPath/>
                                    </Sequence>
                                </Inverter>
                                <Sequence>
                                    <AtCurrentWaypoint/>
                                    <!-- gimbal sub-tree for target 2-->
                                    <Fallback>
                                        <SpinGimbal/>
                                        <Sequence>
                                            <HasTarget2/>
                                            <ResetGimbalIndex/>
                                            <PopulateSecondTarget/>
                                            <GenGateTraversalPath/>
                                        </Sequence>
                                    </Fallback>
                                    <PopCourse/>
                                </Sequence>
                            </Sequence>

                            <!--Sees a target (for first time)-->
                            <Sequence>
                                <HasTarget1/>
                                <PopulateFirstTarget/>
                                <PutTargetAtFrontOfCourse/>
                            </Sequence>

                            <!--Reached Search Point,  refresh course-->
                            <Sequence>
                                <AtCurrentWaypoint/>
                                <!--Repeator Drop Goes here if repeator needs to be added-->
                                <!-- gimbal sub-tree for target 1 -->
                                <Fallback>
                                    <SpinGimbal/>
                                        <Sequence>
                                            <HasTarget2/>
                                            <ResetGimbalIndex/>
                                            <PopulateFirstTarget/>
                                            <PutTargetAtFrontOfCourse/>
                                        </Sequence>
                                </Fallback>
                                <PopCourse/>

                            </Sequence>

                            <!--Repeator Drop Point Detection Goes here-->
                        </Fallback>
                    </Sequence>
                    <!--Destination Point-->
                    <Sequence>
                        <IsDestinationPoint/>
                        <Sequence>
                            <AtCurrentWaypoint/>
                            <GenSearchPoints/>
                        </Sequence>
                    </Sequence>
                    <!--Gate Traversal Point-->
                    <Sequence>
                        <IsGateTraversalPoint/>
                        <!-- GATE TRAVERSAL TREE -->
                        <Sequence>
                            <AtCurrentWaypoint/>
                            <Fallback>
                                <Sequence>
                                    <Inverter>
                                        <HasGateTraversalPoints/><!--"no more gate traversal points"-->
                                    </Inverter>
                                    <Sequence> <!-- TODO gimbal here -->
                                        <Fallback>
                                            <SpinGimbal/>
                                            <ForceFailure>
                                                <TurnOff/>
                                            </ForceFailure>
                                        </Fallback>
                                        <Sequence>
                                            <HasTarget1/>
                                            <HasTarget2/>
                                            <Fallback>
                                                <VerifyGateTraversal/>
                                                <ForceFailure>
                                                    <TurnOff/>
                                                </ForceFailure>
                                            </Fallback>
                                        </Sequence>
                                    </Sequence>
                                    <Fallback>
                                        <GenGateTraversalPath/>
                                        <TurnOff/>
                                    </Fallback>
                                </Sequence>
                                <Sequence>
                                    <HasGateTraversalPoints/>
                                    <PopCourse/>
                                </Sequence>
                            </Fallback>
                        </Sequence>
                    </Sequence>
                    <!--Target Approach Point-->
                    <Sequence>
                        <IsTargetApproachPoint/>
                        <!--Target Approach Tree-->
                        <Sequence>
                            <AtCurrentWaypoint/>
                            <Fallback>
                                <Sequence>
                                    <IsARTagLeg/>
                                    <ClearCourse/>
                                </Sequence>
                                <GenSecondPostSearchPattern/>
                            </Fallback>
                        </Sequence>
                    </Sequence>
                </Fallback>
            </Sequence>
        </Fallback>
    </BehaviorTree>
</root>